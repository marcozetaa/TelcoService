<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Purchase</title>
</head>
<body>
    <div align="right">
        <a th:href="@{/Home}">Homepage</a>
    </div>

    <h1>"Purchase form"</h1>


    <form th:action="@{/Confirmation(package_id=${package.getid()})}" method="POST">
        <fieldset>
            <p>
                Package:  <input type="text" th:name="package_id" th:id="${package.getid()}" th:value="${package.name}" disabled> <br>
            </p>

            <p>
                <label th:for="${products}" >Choose one or more optional product:</label>

                <input type="checkbox" th:each="p : ${package.optionalProducts}" th:name="optional_products" th:value="${p.name}" th:text="${p.name}">
                <br>
            </p>

            <p>
            Validity Period:
                <div data-name="check" name="check">
                    <input type="checkbox" name="val_period" id="12" th:value="12"/>   <label for="12" th:text="${package.fee12} + ' euros for 12 Months'"> </label> <br>
                    <input type="checkbox" name="val_period" id="24" th:value="24" />   <label for="24" th:text="${package.fee24} + ' euros for 24 Months'"></label> <br>
                    <input type="checkbox" name="val_period" id="36" th:value="36" />   <label for="36" th:text="${package.fee36} + ' euros for 36 Months'"></label> <br>
                </div>
            </p>

            <p>
            Start Day:
                <input type="date" name="date"
                      th:attr="min=${#dates.format(#dates.createNow(), 'yyyy-MM-dd')}"
                      placeholder="yyyy-mm-dd" required />
            </p>

            <input type="hidden" name="user" th:value="${session.user.getUserID}">

            <br>
            <div th:if="${session.user != null}">
                <input type="submit" value="Purchase">
            </div>
            <div th:if="${session.user == null}">
                Access to buy
                <a th:href="@{/CheckLogin(package_id=${package.getid()})}">Login</a>
            </div>
            <p th:text=" ${errorMsg}"></p>
        </fieldset>
    </form>
</body>
<script>
    var last;
    document.addEventListener('input',(e)=>{
        var closest=e.target.closest("*[data-name='check']");
        if(e.target.closest("*[data-name]")){
            if(last)
                last.checked=false;
        }
        if(e.target!==last)
            last=e.target;
        else
            last=undefined;
    })

</script>
</html>